# Azure DevOps Main Pipeline for twoChurch
# Simplified version - builds both web and mobile

trigger:
  branches:
    include:
      - main
      - develop
      - feature/*
      - hotfix/*

pr:
  branches:
    include:
      - main
      - develop

pool:
  vmImage: 'ubuntu-latest'

variables:
  nodeVersion: '20.x'

stages:
  - stage: Validate
    displayName: 'Validate Code'
    jobs:
      - job: LintAndFormat
        displayName: 'Lint and Format Check'
        steps:
          - task: NodeTool@0
            displayName: 'Install Node.js'
            inputs:
              versionSpec: $(nodeVersion)

          - task: Npm@1
            displayName: 'Install Dependencies'
            inputs:
              command: 'ci'

          - script: echo 'Linting and testing will be configured per workspace'
            displayName: 'Validation Placeholder'

  - stage: BuildWeb
    displayName: 'Build Web Application'
    dependsOn: Validate
    jobs:
      - job: BuildWebJob
        displayName: 'Build Next.js App'
        steps:
          - task: NodeTool@0
            displayName: 'Install Node.js'
            inputs:
              versionSpec: $(nodeVersion)

          - task: Npm@1
            displayName: 'Install Dependencies'
            inputs:
              command: 'ci'

          - task: Npm@1
            displayName: 'Build Web App'
            inputs:
              command: 'custom'
              customCommand: 'run web:build'

  - stage: BuildMobile
    displayName: 'Build Mobile Application'
    dependsOn: Validate
    jobs:
      - job: BuildMobileJob
        displayName: 'Prepare Mobile Build'
        steps:
          - task: NodeTool@0
            displayName: 'Install Node.js'
            inputs:
              versionSpec: $(nodeVersion)

          - task: Npm@1
            displayName: 'Install Dependencies'
            inputs:
              command: 'ci'

          - script: echo 'Mobile build ready for EAS or Expo'
            displayName: 'Mobile Build Placeholder'
